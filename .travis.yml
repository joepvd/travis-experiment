services:
  - riak           # basic version
  - rabbitmq
  - memcached
  - mysql          # default version, users. No sockets.
  - postgresql     # TODO: postgis, locales
  - mongodb        # version check
  - couchdb
  - redis-server
  - cassandra      # version check
  - neo4j          # version check
  - elasticsearch  # version check

addons:
    rethinkdb: "2.3.5"

install: true

script:
  - echo riak
  - "riak version"
  - "echo ...... mysql ......"
  - "ps aux | grep '[m]ysql' || true"
  - mysql -uroot -e 'SHOW VARIABLES LIKE "%version%";'
  - mysql -utravis -e 'SHOW VARIABLES LIKE "%version%";'
  - mysql -uroot -e 'select * from mysql.users;'
  - "echo ...... postgresql ......"
  - psql -Upostgres <<<'select * from version();'
  - psql -Upostgres <<<'select * from pg_catalog.pg_database;'
  - psql -Upostgres <<<'select * from pg_catalog.pg_user;'
  - mount # To check the ramfs
  - echo neo4j
  - curl http://localhost:7474/db/data/
  - "echo ......... elasticsearch ......."
  - curl http://localhost:9200/_nodes
  - "echo ......... cassandra ........"
  - "cqlsh -f <(echo show version)"
  - "cqlsh -f <(echo 'select * from system.local;')"
  - "echo ..... mongodb ......."
  - "mongo mydb_test --eval 'db.addUser(\"travis\", \"test\");' || true"
  - mongo --eval 'db.version()'


language: minimal

notifications:
  email: never

matrix:
  include:
      - env: stack=gce-trusty
        sudo: required
        dist: trusty
      - env: stack=gce-precise
        sudo: required
        dist: precise
      - env: stack=ec2-trusty
        sudo: false
        dist: trusty
      - env: stack=ec2-precise
        sudo: false
        dist: precise
