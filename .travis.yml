language: bash
jobs:
  include:
  - stage: test
    env: dist=precise group=deprecated-2017Q1
    dist: precise
    group: deprecated-2017Q1
    sudo: required
  - env: dist=precise group=stable-20161201
    dist: precise
    group: stable-20161201
    sudo: required
  - env: dist=trusty group=deprecated-2017Q4
    dist: trusty
    group: deprecated-2017Q4
    sudo: required
  - env: dist=trusty group=stable-20161201
    dist: trusty
    group: stable-20161201
    sudo: required
  - env: dist=trusty group=stable-20170621
    dist: trusty
    group: stable-20170621
    sudo: required
  - env: dist=precise group=deprecated
    dist: precise
    group: deprecated
    sudo: required
  - env: dist=trusty group=deprecated-2017Q3
    dist: trusty
    group: deprecated-2017Q3
    sudo: required
  - env: dist=trusty group=deprecated-2017Q2
    dist: trusty
    group: deprecated-2017Q2
    sudo: required
  - env: dist=trusty group=deprecated
    dist: trusty
    group: deprecated
    sudo: required
  - env: dist=trusty group=stable
    dist: trusty
    group: stable
    sudo: required
  - env: dist=trusty group=stable-20161202
    dist: trusty
    group: stable-20161202
    sudo: required
  - env: dist=precise group=stable
    dist: precise
    sudo: required
  - env: dist=xenial group=edge
    dist: xenial
    group: edge
    sudo: required
  - env: dist=xcode10
    osx_image: xcode10
    os: osx
  - env: dist=xcode9.4
    osx_image: xcode9.4
    os: osx
  - env: dist=xcode9.3
    osx_image: xcode9.3
    os: osx
  - env: dist=xcode9.2
    osx_image: xcode9.2
    os: osx
  - env: dist=xcode9.1
    osx_image: xcode9.1
    os: osx
  - env: dist=xcode9
    osx_image: xcode9
    os: osx
  - env: dist=xcode8.3
    osx_image: xcode8.3
    os: osx
  - env: dist=xcode8
    osx_image: xcode8
    os: osx
  - env: dist=xcode7.3
    osx_image: xcode7.3
    os: osx
  - env: dist=xcode6.4
    osx_image: xcode6.4
    os: osx
  - stage: report
    install: sleep 480
    script:
    - |
        for job in $(
          curl --silent \
              -H "Travis-API-Version: 3" \
              -H "User-Agent: API Explorer" \
              -H "Authorization: token $token" \
              https://api.travis-ci.org/build/$TRAVIS_BUILD_ID \
          | jq '.jobs[].id')
        do
          [[ $job = $TRAVIS_JOB_ID ]] && continue
          echo $job
          curl -L -H "Authorization: token $token" https://api.travis-ci.org/jobs/$job/log.txt >$job.log
        done
    - |
        curl --silent \
            -H "Travis-API-Version: 3" \
            -H "User-Agent: API Explorer" \
            -H "Authorization: token $token" \
            https://api.travis-ci.org/build/$TRAVIS_BUILD_ID \
        | jq '.jobs[].id'
    - 'grep travis_internal_ruby: *.log'

install: skip
script:
    - |
        default_ruby_version() {
          if [[ $(travis_internal_ruby) == default ]]; then
            rvm use default
            ruby --version | awk '{print $2}'
          else
            travis_internal_ruby
          fi
        }
    - 'echo "travis_internal_ruby: $dist: $group: $(default_ruby_version)"'
env:
  global:
    - secure: "sF7L6WekMDt5iQnBUiAJUNbiVkkbjEKrGqEkDk3wORNyd2YONM6dZrbadXWpHLIT5xg21aj0NvBsy1OoF+QzfFPNmCPrEsFm5n/vYazDe+cOLWNFDkPDd+TwrRp3HpnAnIyMe+C5hQJKZonSLWoaiYVWMk9oUqla4U4Tns5FT6bSGSRiMJUQP1HClkkwP9CljWBm+fJL2QNH5oCepwCbuLd/6TbQoCkI69X/zqk9jif0iS128oiuv+Cz0kjv4AT7IOHIzO3DD+h/myjgaRzSk0b0y7U+EjkM5ZTJU7FhxHZSRL5q0JzS1tnH8xfIFPmh5/WgVCehxkAr0FR3yfc80qi+4bxprT4Kdatq1nexCflqrN1Poqu4uFKn+asIN3Pp88eFH2AWfIrHIYnnfXVaWpnPG8PXQ4nvfMyVVeCNTgGRXHcPN5z1P6CsowYNJfm2lU3YAtulcVAEV/7SOmGLxf6T/O+cCC/umokGh7s7QbeD4uU1fjR0f6DDnK5Hn8B+SA3b/5RwaAj/VYKEnAWlzcqFQ2xgwcjnpvexCihuh4Ht/0JMWOHUZgL3PkhxoSJaHJvMqorLjZHaDPqh9RGi+05W/N+PvQz+LCG7brufjWWtTWpg76v7yHE5fl4QbSjgVHVvU5ktP1/cAX3ByLGYWaMAvB+JwqITemKL7nZ4zvM="
notifications:
  email: never
