language: generic
dist: precise
sudo: false
addons:
    apt:
        packages:
            - sysstat
before_install:
    - |
        perf_log() {
            awk -v cmd="$cmd" '{print "perf:", cmd, systime(), $0}'
        }

        perf_observe() {
            local timeout=${1-5}
            local cmd
            for cmd in                    \
                "uptime"                  \
                "dmesg | tail"            \
                "vmstat $timeout"         \
                "mpstat -P ALL $timeout"  \
                "pidstat $timeout"        \
                "iostat -xz $timeout"     \
                "free -m"                 \
                "sar -n DEV $timeout"     \
                "sar -n TCP,ETCP $timeout"
            do
                if [[ $cmd =~ [0-9]$ ]]; then
                    $cmd | perf_log &
                else
                    while sh -c "$cmd" | perf_log; do sleep $timeout; done &
                fi
            done
        }

install: perf_observe
script: sleep 11
notifications:
    email: false
