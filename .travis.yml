language: ruby
sudo: false
dist: precise
addons:
    apt:
        packages:
            - smem
            - gnuplot
install:
    - |
        while sleep 2; do
            pids="$(ps aux | awk 'NR>1{printf $2"|"};END{print 999999999999}')"
            smem -tP "$pids" | awk 'END{print $5}' >>/tmp/memtotal
        done &
script:
    - dpkg -L heroku
    - sleep 30
    - awk '{print NR*2, $1}' /tmp/memtotal > /tmp/mem.data
after_script:
    - echo -e 'set term dumb\nplot mem.data\n' >/tmp/plot
    - gnuplot /tmp/plot
notifications:
    email: false
