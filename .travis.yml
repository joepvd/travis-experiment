language: minimal
matrix:
    include:
        - env: test=osx-nofilter
          os: osx
          osx_image: xcode7.3
          install: true
        - env: test=osx-filter
          os: osx
          osx_image: xcode7.3
          install:
              - exec 999>&1
              - exec 1> >( awk '{print "filter!", $0}')
              - exec 2>&1
        - env: test=container-nofilter
          dist: trusty
          sudo: false
          install: true
        - env: test=container-filter
          dist: trusty
          sudo: false
          install:
              - exec 999>&1
              - exec 1> >( awk '{print "filter!", $0}')
              - exec 2>&1
        - env: test=sudo-nofilter
          dist: trusty
          sudo: required
          install: true
        - env: test=sudo-filter
          dist: trusty
          sudo: required
          install:
              - exec 999>&1
              - exec 1> >( awk '{print "filter!", $0}')
              - exec 2>&1
filter_secrets: false
install:
    - exec 999>&1
    - exec 1> >( awk '{print "filter!", $0}')
    - exec 2>&1
script:
    - echo a line to stdout 
    - echo a line to stderr >&2
after_script:
    - "[[ -e /dev/fd/999 ]] && command exec 1>&999 2>&999 999>&- && sync"
    - echo a line to stdout 
    - echo a line to stderr >&2

notifications:
    email: never
