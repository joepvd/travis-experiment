
language: bash
matrix:
    include:
        - env: test=ssh-agent filter=true image=container-trusty
          sudo: false
          dist: trusty
          install: eval `ssh-agent -s`
        - env: filter=false image=container-trusty
          sudo: false
          dist: trusty
          filter_secrets: false
          install: eval `ssh-agent -s`
        - env: test=sleep filter=true image=container-trusty
          sudo: false
          dist: trusty
          install: "setsid sh -c 'sleep 1000' &"
        - env: test=sleep filter=false image=container-trusty
          sudo: false
          dist: trusty
          filter_secrets: false
          install: "setsid sh -c 'sleep 1000' &"

install:
script:
    - sleep 1
    - echo $$
    - ps -jef --forest 2>/dev/null || ps -jef
      #- '[[ "$TRAVIS_FILTERED" = redirect_io && -e /dev/fd/9 ]] && sync && command exec 1>&9 2>&9 9>&- && sync'
      #- if [ -f /.dockerenv ]; then kill -9 $(awk -v pid=$$ '$1!=pid' <(ps --no-headers --user $USER -opid:1)); else pkill -9 -P $$; fi
    - kill -9 $(awk -v pid=$$ '$1!=pid' <(ps --no-headers --user $USER -opid:1))
notifications:
    email: never
